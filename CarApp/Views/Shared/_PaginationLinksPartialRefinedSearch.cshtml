@using CarApp.Core.ViewModels.RefinedSearch
@model RefinedSearchViewModel
@{
    var previousPage = Model.CurrentPage - 1;
    if (previousPage < 1)
    {
        previousPage = 1;
    }

    var maxPage = Math.Ceiling((double)Model.TotalCarsCount /
        Model.CarsPerPage);

    var nextPage = Model.CurrentPage + 1 <= maxPage ? Model.CurrentPage + 1 : maxPage;
}

<div class="row mb-5 mt-5">
    <div class="col-md-4 d-grid gap-2 d-md-flex justify-content-md-start">
        <a class="btn btn-primary @(Model.CurrentPage == 1 ? "disabled" : string.Empty)"
           asp-controller="RefinedSearch"
           asp-action="Index"
           asp-route-Brand="@Model.Brand"
           asp-route-Model="@Model.Model"
           asp-route-MinYear="@Model.MinYear"
           asp-route-MaxYear="@Model.MaxYear"
           asp-route-MinPrice="@Model.MinPrice"
           asp-route-MaxPrice="@Model.MaxPrice"
           asp-route-MinWhp="@Model.MinWhp"
           asp-route-MaxWhp="@Model.MaxWhp"
           asp-route-MinEngineDisplacement="@Model.MinEngineDisplacement"
           asp-route-MaxEngineDisplacement="@Model.MaxEngineDisplacement"
           asp-route-MaxMilleage="@Model.Mileage"
           asp-route-Fuel="@Model.Fuel"
           asp-route-CarBody="@Model.CarBody"
           asp-route-Drivetrain="@Model.Drivetrain"
           asp-route-Gear="@Model.Gear"
           asp-route-Sorting="@((int)Model.Sorting)"
           asp-route-CurrentPage="@previousPage">Previous</a>
    </div>

    <div class="col-4 text-center">
        @{
            int currentPage = Model.CurrentPage;
            List<int> pagesToShow = new List<int>();

            if (currentPage == 1)
            {
                pagesToShow.Add(currentPage);
                if (currentPage + 1 <= maxPage) pagesToShow.Add(currentPage + 1);
                if (currentPage + 2 <= maxPage) pagesToShow.Add(currentPage + 2);
            }
            else if (currentPage == (int)maxPage)
            {
                if (currentPage - 2 > 0) pagesToShow.Add(currentPage - 2);
                if (currentPage - 1 > 0) pagesToShow.Add(currentPage - 1);
                pagesToShow.Add(currentPage);
            }
            else
            {
                if (currentPage - 1 > 0) pagesToShow.Add(currentPage - 1);
                pagesToShow.Add(currentPage);
                if (currentPage + 1 <= (int)maxPage) pagesToShow.Add(currentPage + 1);
            }
        }
        @if (currentPage != 1 && 1 + currentPage > 3 && maxPage > 3)
        {
            <a class="btn btn-dark"
               asp-controller="RefinedSearch"
               asp-action="Index"
               asp-route-Brand="@Model.Brand"
               asp-route-Model="@Model.Model"
               asp-route-MinYear="@Model.MinYear"
               asp-route-MaxYear="@Model.MaxYear"
               asp-route-MinPrice="@Model.MinPrice"
               asp-route-MaxPrice="@Model.MaxPrice"
               asp-route-MinWhp="@Model.MinWhp"
               asp-route-MaxWhp="@Model.MaxWhp"
               asp-route-MinEngineDisplacement="@Model.MinEngineDisplacement"
               asp-route-MaxEngineDisplacement="@Model.MaxEngineDisplacement"
               asp-route-MaxMilleage="@Model.Mileage"
               asp-route-Fuel="@Model.Fuel"
               asp-route-CarBody="@Model.CarBody"
               asp-route-Drivetrain="@Model.Drivetrain"
               asp-route-Gear="@Model.Gear"
               asp-route-Sorting="@((int)Model.Sorting)"
               asp-route-CurrentPage="1">
                1
            </a>
        }
        <div class="btn-group" role="group" aria-label="Pagination buttons">
            @foreach (var listingPage in pagesToShow)
            {
                if (listingPage == currentPage)
                {
                    <span class="btn btn-primary disabled">@listingPage</span>
                }
                else
                {
                    <a class="btn btn-outline-primary"
                       asp-controller="RefinedSearch"
                       asp-action="Index"
                       asp-route-Brand="@Model.Brand"
                       asp-route-Model="@Model.Model"
                       asp-route-MinYear="@Model.MinYear"
                       asp-route-MaxYear="@Model.MaxYear"
                       asp-route-MinPrice="@Model.MinPrice"
                       asp-route-MaxPrice="@Model.MaxPrice"
                       asp-route-MinWhp="@Model.MinWhp"
                       asp-route-MaxWhp="@Model.MaxWhp"
                       asp-route-MinEngineDisplacement="@Model.MinEngineDisplacement"
                       asp-route-MaxEngineDisplacement="@Model.MaxEngineDisplacement"
                       asp-route-MaxMilleage="@Model.Mileage"
                       asp-route-Fuel="@Model.Fuel"
                       asp-route-CarBody="@Model.CarBody"
                       asp-route-Drivetrain="@Model.Drivetrain"
                       asp-route-Gear="@Model.Gear"
                       asp-route-Sorting="@((int)Model.Sorting)"
                       asp-route-CurrentPage="@listingPage">
                        @listingPage
                    </a>
                }
            }
        </div>
        @if (currentPage != maxPage && maxPage - currentPage > 1 && maxPage > 3)
        {
            <a class="btn btn-dark"
               asp-controller="RefinedSearch"
               asp-action="Index"
               asp-route-Brand="@Model.Brand"
               asp-route-Model="@Model.Model"
               asp-route-MinYear="@Model.MinYear"
               asp-route-MaxYear="@Model.MaxYear"
               asp-route-MinPrice="@Model.MinPrice"
               asp-route-MaxPrice="@Model.MaxPrice"
               asp-route-MinWhp="@Model.MinWhp"
               asp-route-MaxWhp="@Model.MaxWhp"
               asp-route-MinEngineDisplacement="@Model.MinEngineDisplacement"
               asp-route-MaxEngineDisplacement="@Model.MaxEngineDisplacement"
               asp-route-MaxMilleage="@Model.Mileage"
               asp-route-Fuel="@Model.Fuel"
               asp-route-CarBody="@Model.CarBody"
               asp-route-Drivetrain="@Model.Drivetrain"
               asp-route-Gear="@Model.Gear"
               asp-route-Sorting="@((int)Model.Sorting)"
               asp-route-CurrentPage="@maxPage">
                @maxPage
            </a>
        }

    </div>


    @{
        var shouldButtonBeDisabled = Model.CurrentPage == maxPage ||
        !Model.CarListings.Any();
    }

    <div class="col-md-4 d-grid gap-2 d-md-flex justify-content-md-end">
        <a class="btn btn-primary @(shouldButtonBeDisabled ? "disabled" : string.Empty)"
           asp-controller="RefinedSearch"
           asp-action="Index"
           asp-route-Brand="@Model.Brand"
           asp-route-Model="@Model.Model"
           asp-route-MinYear="@Model.MinYear"
           asp-route-MaxYear="@Model.MaxYear"
           asp-route-MinPrice="@Model.MinPrice"
           asp-route-MaxPrice="@Model.MaxPrice"
           asp-route-MinWhp="@Model.MinWhp"
           asp-route-MaxWhp="@Model.MaxWhp"
           asp-route-MinEngineDisplacement="@Model.MinEngineDisplacement"
           asp-route-MaxEngineDisplacement="@Model.MaxEngineDisplacement"
           asp-route-MaxMilleage="@Model.Mileage"
           asp-route-Fuel="@Model.Fuel"
           asp-route-CarBody="@Model.CarBody"
           asp-route-Drivetrain="@Model.Drivetrain"
           asp-route-Gear="@Model.Gear"
           asp-route-CurrentPage="@nextPage"
           asp-route-Sorting="@((int)Model.Sorting)">Next</a>
    </div>
</div>