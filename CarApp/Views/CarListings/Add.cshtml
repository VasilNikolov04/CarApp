@model CarViewModel

<meta charset="UTF-8">
<div class="container mt-5">
    <h2 class="mb-4">Add a New Car Listing</h2>

    <!-- Start the form -->
    <form asp-action="Add" method="post" enctype="multipart/form-data">

        <div class="row">
            <!-- Car Brand and Model Dropdowns Side by Side -->
            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="BrandId">Car Brand</label>
                    <select id="carBrand" asp-for="BrandId" class="form-control"
                            asp-items="@(new SelectList(Model.Brands, "Id", "BrandName"))" onchange="updateModels()" required>
                        <option value="">Select a Brand</option>
                    </select>
                    <span asp-validation-for="BrandId" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="ModelId">Car Model</label>
                    <select id="carModel" asp-for="ModelId" class="form-control" required>
                        <option value="">Select a Model</option>
                    </select>
                    <span asp-validation-for="ModelId" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-12">
                <div class="form-group">
                    <label asp-for="Description">Description</label>
                    <textarea asp-for="Description" class="form-control" rows="3" placeholder="Enter description"></textarea>
                    <span asp-validation-for="Description" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="Year">Year</label>
                    <input asp-for="Year" type="number" class="form-control" min="1930" max="@DateTime.Now.Year" placeholder="Enter Year" required>
                    <span asp-validation-for="Year" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="Whp">Horsepower</label>
                    <input asp-for="Whp" type="number" class="form-control" min="0" placeholder="Enter Horsepower" required>
                    <span asp-validation-for="Whp" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="Price">Price</label>
                    <div class="input-group">
                        <span class="input-group-text">€</span>
                        <input asp-for="Price" class="form-control" type="number" min="1" step="1" placeholder="Enter Price" required>
                    </div>
                    <span asp-validation-for="Price" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-6">
                <div class="form-group">
                    <label asp-for="Milleage">Mileage</label>
                    <input asp-for="Milleage" type="number" class="form-control" min="0" placeholder="Enter Mileage" required>
                    <span asp-validation-for="Milleage" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-3">
                <div class="form-group">
                    <label asp-for="@Model.FuelId">Fuel Type</label>
                    <select asp-for="@Model.FuelId" class="form-control" asp-items="@(new SelectList(Model.FuelTypes, "Id", "FuelName"))" required>
                        <option value="">Select Fuel Type</option>
                    </select>
                    <span asp-validation-for="@Model.FuelId" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group">
                    <label asp-for="@Model.GearId">Transmission</label>
                    <select asp-for="@Model.GearId" class="form-control" asp-items="@(new SelectList(Model.Gears, "Id", "GearName"))" required>
                        <option value="">Select Transmission</option>
                    </select>
                    <span asp-validation-for="@Model.GearId" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group">
                    <label asp-for="@Model.DrivetrainId">Drivetrain</label>
                    <select asp-for="@Model.DrivetrainId" class="form-control" asp-items="@(new SelectList(Model.Drivetrains, "Id", "DrivetrainName"))" required>
                        <option value="">Select Drivetrain</option>
                    </select>
                    <span asp-validation-for="@Model.DrivetrainId" class="text-danger"></span>
                </div>
            </div>

            <div class="col-md-3">
                <div class="form-group">
                    <label asp-for="@Model.CarBodyId">Car Body Type</label>
                    <select asp-for="@Model.CarBodyId" class="form-control" asp-items="@(new SelectList(Model.CarBodyTypes, "Id", "Name"))" required>
                        <option value="">Select Body Type</option>
                    </select>
                    <span asp-validation-for="@Model.CarBodyId" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-12">
                <div class="form-group">
                    <label asp-for="@Model.CarImages">Insert Images</label>
                    <input asp-for="@Model.CarImages" type="file" class="form-control-file" id="CarImages" name="CarImages" multiple required>
                    <span asp-validation-for="@Model.CarImages" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <button type="submit" class="btn btn-primary w-100">Submit</button>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script src="~/js/carSelection.js"></script>
    
    <script>
        const modelsData = [];

        @foreach (var carModel in Model.Models)
        {
            <text>
               modelsData.push({
                    BrandId: @carModel.BrandId,
                    ModelId: @carModel.Id,
                    ModelName: "@Html.Raw(@carModel.ModelName)"
               });
            </text>
        }

        populateCarModels(modelsData);
    </script>
}